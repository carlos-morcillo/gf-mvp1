<div class="list-page__header">
  <div class="list-page__header-actions">
    <h3 class="list-page__title">
      {{ "DASHBOARD.TITLE" | transloco }}
    </h3>
  </div>
  <p class="list-page__description">
    {{ "DASHBOARD.SUBTITLE" | transloco }}
  </p>
  <div class="input-group mb-4">
    <input
      type="search"
      class="form-control"
      [formControl]="searchControl"
      [placeholder]="'DASHBOARD.SEARCH.PLACEHOLDER' | transloco"
    />
    @if (searchControl.value) {
    <button
      type="button"
      class="btn btn-outline-secondary"
      (click)="clearSearch()"
    >
      <i class="fa fa-times"></i>
    </button>
    }
  </div>
</div>

<div class="list-page__content">
  @if (!searchSignal()) {

  <!-- Hero / Encuesta -->
  <section
    class="bg-light d-flex flex-column align-items-center justify-content-center py-5 text-center px-3 rounded"
  >
    <h2 class="display-6 fw-bold text-dark mb-4 lh-sm" style="max-width: 768px">
      ¬øNo has respondido la encuesta de evaluaci√≥n todav√≠a?
    </h2>
    <a
      href="https://forms.office.com/Pages/ResponsePage.aspx?id=Hiqttwiab0u1GUVodBQvvZYuSP2sOIFNoxLuOyYj9KdURVlETUtFRFhDTlJMWE9NSVk0ODVZMkpHUS4u"
      target="_blank"
      class="btn btn-success px-4 py-2 fw-medium text-uppercase shadow"
    >
      Accede a la evaluaci√≥n
    </a>
  </section>

  <!-- Novedades -->
  <section class="mt-5">
    <h3 class="fs-5 fw-semibold d-flex align-items-center gap-2 mb-4">
      <i class="bi bi-bell text-success"></i>
      <span>Novedades</span>
    </h3>

    <div class="d-flex flex-column gap-3">
      <!-- Noticia 1 -->
      <div
        class="d-flex align-items-center gap-3 p-3 bg-white border rounded shadow-sm"
      >
        <i class="bi bi-lightning-charge text-success fs-4"></i>
        <div>
          <p class="fw-medium text-dark mb-1">
            Nueva misi√≥n semanal desbloqueada: "Crea tu primer agente"
          </p>
          <p class="text-muted small mb-0">Hace 2 d√≠as</p>
        </div>
      </div>

      <!-- Noticia 2 -->
      <div
        class="d-flex align-items-center gap-3 p-3 bg-white border rounded shadow-sm"
      >
        <i class="bi bi-gift text-success fs-4"></i>
        <div>
          <p class="fw-medium text-dark mb-1">
            Recompensas actualizadas: nuevo curso premium disponible
          </p>
          <p class="text-muted small mb-0">Hace 5 d√≠as</p>
        </div>
      </div>

      <!-- Noticia 3 -->
      <div
        class="d-flex align-items-center gap-3 p-3 bg-white border rounded shadow-sm"
      >
        <i class="bi bi-people text-success fs-4"></i>
        <div>
          <p class="fw-medium text-dark mb-1">
            Nuevo rango desbloqueado: "Maestro de la IA"
          </p>
          <p class="text-muted small mb-0">Hace 1 semana</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Logros Recientes -->
  <section class="my-5">
    <h3 class="fs-5 fw-semibold d-flex align-items-center gap-2 mb-4">
      <i class="bi bi-trophy text-success"></i>
      <span>Logros Recientes</span>
    </h3>

    <div class="row g-4">
      <!-- Logro: IA Curioso -->
      <div class="col-12 col-sm-6 col-lg-4">
        <div class="bg-light border rounded p-4 shadow-sm h-100">
          <div class="d-flex align-items-center gap-3">
            <span class="fs-3">üßê</span>
            <div>
              <h4 class="fw-bold text-dark">IA Curioso</h4>
              <p class="text-muted mb-1">+100 XP</p>
              <p class="text-muted small">Desbloqueado el 15/01/2024</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Logro: Constructor de Agentes -->
      <div class="col-12 col-sm-6 col-lg-4">
        <div
          class="bg-info-subtle border border-info rounded p-4 shadow-sm h-100"
        >
          <div class="d-flex align-items-center gap-3">
            <span class="fs-3">‚öôÔ∏è</span>
            <div>
              <h4 class="fw-bold text-info">Constructor de Agentes</h4>
              <p class="text-muted mb-1">+200 XP</p>
              <p class="text-muted small">Desbloqueado el 20/01/2024</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Logro: Explorador del Marketplace -->
      <div class="col-12 col-sm-6 col-lg-4">
        <div class="bg-light border rounded p-4 shadow-sm h-100">
          <div class="d-flex align-items-center gap-3">
            <span class="fs-3">üè™</span>
            <div>
              <h4 class="fw-bold text-dark">Explorador del Marketplace</h4>
              <p class="text-muted mb-1">+150 XP</p>
              <p class="text-muted small">Desbloqueado el 18/01/2024</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  } @if (!searchSignal()) {
  <div class="row">
    <div class="col-12 col-lg-8">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="h5 mb-0">
          {{ "DASHBOARD.RECENT_CONVERSATIONS" | transloco }}
        </h3>
        <button class="btn btn-light border" routerLink="/private/chats">
          {{ "DASHBOARD.SEE_ALL" | transloco }}
        </button>
      </div>
      @for (chat of chats.value(); track chat.id) {
      <div
        class="card p-3 mb-3 shadow-sm chat"
        role="button"
        (click)="openChat(chat.id)"
      >
        <div class="d-flex align-items-center">
          <div class="me-3">
            <span class="text-bg-primary p-2 rounded-circle">
              <i class="bi bi-chat-left"></i>
            </span>
            <!-- @if (chat.avatar) {
                  <img
                    [src]="chat.avatar"
                    class="rounded-circle"
                    width="40"
                    height="40"
                    />
                } -->
          </div>
          <div class="flex-grow-1">
            <div class="fw-bold">{{ chat.title }}</div>
            <!-- <small class="text-muted">{{ chat.agentName }}</small> -->
            <!-- @if (chat.active) {
                  <span class="badge bg-success ms-2">Activa</span>
                } -->
          </div>
          <div class="ms-auto text-nowrap small text-muted">
            {{ timeAgo(chat.updated_at * 1000) }}
          </div>
        </div>
      </div>
      }
    </div>
    <div class="col-12 col-lg-4">
      <div class="mb-4">
        <h3 class="h6">{{ "DASHBOARD.QUICK_ACTIONS.TITLE" | transloco }}</h3>
        <button
          class="btn btn-success w-100 text-start mb-2"
          (click)="openNewAgent()"
        >
          {{ "DASHBOARD.QUICK_ACTIONS.NEW_AGENT" | transloco }}
        </button>
        <button
          class="btn btn-outline-secondary w-100 text-start mb-2"
          (click)="exploreMarketplace()"
          disabled
        >
          {{ "DASHBOARD.QUICK_ACTIONS.EXPLORE_MARKETPLACE" | transloco }}
        </button>
        <button
          class="btn btn-outline-secondary w-100 text-start mb-2"
          (click)="viewFavorites()"
          disabled
        >
          {{ "DASHBOARD.QUICK_ACTIONS.FAVORITES" | transloco }}
        </button>
      </div>
      <div>
        <h3 class="h6">{{ "DASHBOARD.AVAILABLE_AGENTS.TITLE" | transloco }}</h3>
        @for (ag of agents.value(); track ag.id) {
        <div
          class="card p-2 mb-2 d-flex align-items-center agent"
          role="button"
          (click)="openAgent(ag.id)"
        >
          @if (ag.meta.profile_image_url) {
          <img
            [src]="ag.meta.profile_image_url"
            class="rounded-circle me-2"
            width="32"
            height="32"
          />
          }
          <div class="flex-grow-1">
            <span class="fw-bold">{{ ag.name }}</span>
          </div>
          <span class="badge bg-secondary text-capitalize">{{ ag.type }}</span>
        </div>
        }
      </div>
    </div>
  </div>
  } @else {
  <div class="row">
    <div class="col-12">
      <h3 class="h6">{{ "DASHBOARD.RESULTS.AGENTS" | transloco }}</h3>
      @if (resultAgents().length) {
      <ul class="list-group">
        @for (ag of resultAgents(); track ag.id) {
        <li class="list-group-item d-flex gap-2 align-items-center">
          @if (ag.meta?.profile_image_url) {
          <img
            [src]="ag.meta.profile_image_url"
            class="rounded-circle me-2"
            width="32"
            height="32"
          />
          }
          <div class="flex-grow-1">
            <span class="fw-bold">{{ ag.name }}</span>
          </div>
        </li>
        }
      </ul>

      } @else {
      <div class="alert alert-info" role="alert">
        No se han encontrado agentes con ese nombre
      </div>

      }

      <h3 class="h6 mt-4">{{ "DASHBOARD.RESULTS.CHATS" | transloco }}</h3>
      @if (resultAgents().length) {
      <ul class="list-group">
        @for (chat of resultChats(); track chat.id) {
        <li class="list-group-item d-flex gap-2 align-items-center">
          <div class="flex-grow-1">
            <div class="fw-bold">{{ chat.title }}</div>
          </div>
          <div class="ms-auto text-nowrap small text-muted">
            {{ timeAgo(chat.updated_at * 1000) }}
          </div>
        </li>
        }
      </ul>

      } @else {
      <div class="alert alert-info" role="alert">
        No se han encontrado chats con ese nombre
      </div>

      }
    </div>
  </div>
  }
</div>
